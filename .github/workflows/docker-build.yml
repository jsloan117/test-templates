---
name: docker build

on: push

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions: {}

jobs:
  build:
    # name: call docker build
    uses: ./.github/workflows/docker-build-template.yml
    permissions:
      contents: read
      packages: write
    secrets:
      dockerhub-username: ${{ github.actor }}
      dockerhub-token: ${{ secrets.DOCKERHUB_TOKEN }}
      cosign-key: ${{ secrets.COSIGN_KEY }}
      cosign-password: ${{ secrets.COSIGN_KEYPASS }}
    with:
      dockerhub-enable: true
      cosign-sign-enable: true
      cosign-verify-enable: true
      cosign-upload-key: true
      # images: ghcr.io/${{ github.repository }}
      # build-args: |
      #   BUILDTIME=${{ fromJSON(steps.meta.outputs.json).labels['org.opencontainers.image.created'] }}
      #   VERSION=${{ fromJSON(steps.meta.outputs.json).labels['org.opencontainers.image.version'] }}
      #   REVISION=${{ fromJSON(steps.meta.outputs.json).labels['org.opencontainers.image.revision'] }}

